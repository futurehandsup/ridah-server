<% include ../templates/head.ejs %>
<div class="row">
  <div class="col bg-lighter">
    <div class="container-fluid" style="padding-top: 80px;">
      <ul class="pagination justify-content-center text-center">
        <li class="page-item">
          <%
          var m_date = new Date(calendar.date);
          m_date.setMonth(m_date.getMonth()-1);
          %>
          <% var prev_date = m_date.getFullYear() + "-" + (m_date.getMonth()+1) + "-" + m_date.getDate();%>
          <a class="page-link" href="daily?type=monthly&date=<%=prev_date%>" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          <span class="sr-only">Previous</span>
          </a>
        </li>
        <h2 class="text-center" style="">
         
          <%=m_date.getFullYear()%>년 <%=m_date.getMonth()+1%>월
        </h2>
        <li class="page-item">
          <% m_date.setMonth(m_date.getMonth()+2);%>
          <% var next_date = m_date.getFullYear() + "-" + (m_date.getMonth()+1) + "-" + m_date.getDate();%>
          <a class="page-link" href="daily?type=monthly&date=<%=next_date%>" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
          </a>
        </li>
      </ul>

      <table class="table table-bordered">
        <% var dates = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"]%>
        <thead class="">
          <tr>
          <% for(date in dates){%>
            <th scope="col"><%=dates[date]%></th>
          <%}%>
          </tr>
        </thead>
        <tbody>
        <% var today_schedule;%>
        <% for(var i=0; i < calendar.schedules.length; i++){ %>
          <%
          var schedule = calendar.schedules[i];
          var s_date = new Date(schedule.date)
          var m = s_date.getDay();
          var flag_today = false;
          var flag_selected = false;

          if(s_date.getFullYear() == m_date.getFullYear() && s_date.getMonth() == m_date.getMonth() &&s_date.getDate() == m_date.getDate()){
            today_schedule = schedule;
            flag_selected = true;
          }
          %>
          <% if(i==0){ %>
            <tr>
              <%for(var j=0; j<m; j++){ %>
              <td></td>
              <% } %>
          <% } else if(m%7 == 0){%><tr><%}%>
            <% var today = new Date();
            if(s_date.getFullYear() == today.getFullYear() && s_date.getMonth() == today.getMonth() && s_date.getDate() == today.getDate()){
              flag_today = true;
            }%>
          <td class="<%=flag_today?'today':''%> <%=flag_selected?'selected':''%>">
            <a href="?type=monthly&date=<%=s_date.getFullYear()%>-<%=(s_date.getMonth()+1)%>-<%=(s_date.getDate())%>"><%=s_date.getDate()%></a><br>
            <%for (var j=0; j < schedule.programs.length; j++){%>
            <% var program = schedule.programs[j];%>
              <div class="program">
                <span class="timebadge timebadge-<%=(program.isReserved)? 'reserved' : 'available' %>"><%=program.time.start_at%></span><br>
                <%=program.programname%>
              </div>
            <% } %>
          </td>
          <% if(i==calendar.schedules.length-1){
              for(var j=m; j < 6; j++){
          %>
              <td></td>
              <% } %>
            </tr>
          <% } else if(m%7 == 6){%> </tr> <%}%>
        <% } %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-3">
    <div class="" style="padding: 30px">
      <h1 class="text-cetnter">19</h1>
      <%if(today_schedule!=null){%>
        <ul class="timeline">
        <%for (p of today_schedule.programs){%>
          <li>
            <span class="marker"></span>
            <div><%=p.time.start_at%></div>
            <div>전소현 님</div>
            프로그램
            체험 승마
          </li>
          <%}%>
        </ul>
      <%} else { %>
        <ul class="timeline">
          <li>
            <span class="marker"></span>
            <div>오늘 예약 정보가 없읍ㅈ니당 </div>

          </li>
        </ul>
      <%}%>

    </div>
  </div>
</div>
<% include ../templates/bottom.ejs %>
